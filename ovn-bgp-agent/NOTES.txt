{{- if .Values.manifests.daemonset_ovn_bgp_agent }}
================================================================================
OVN BGP Agent has been successfully deployed!
================================================================================

DEPLOYMENT STATUS
-----------------
Check deployment status:

  kubectl --namespace {{ .Release.Namespace }} get pods -l "application=ovn-bgp-agent"

Expected: All pods should be in "Running" state with 2/2 or 3/3 containers ready.


BGP SESSION STATUS
------------------
Check BGP session status:

  # IPv4 session
  kubectl --namespace {{ .Release.Namespace }} exec daemonset/ovn-bgp-agent -c frr -- \
    vtysh -c "show bgp ipv4 unicast summary"

{{- if .Values.bgp.ipv6.enabled }}
  # IPv6 session
  kubectl --namespace {{ .Release.Namespace }} exec daemonset/ovn-bgp-agent -c frr -- \
    vtysh -c "show bgp ipv6 unicast summary"
{{- end }}

Expected: BGP neighbor state should be "Established"


VIEW CONFIGURATION
------------------
View the discovered BGP configuration:

  kubectl --namespace {{ .Release.Namespace }} logs daemonset/ovn-bgp-agent -c init-frr-config

This shows:
  - Local server IP and auto-generated ASN
  - Detected Leaf switch IPv4{{- if .Values.bgp.ipv6.enabled }} and IPv6{{- end }} addresses
  - Network reachability status
{{- if .Values.bgp.evpn.enabled }}
  - EVPN Route Reflector configuration
{{- end }}


LEAF CONFIGURATION MANAGEMENT
-----------------------------
View or edit Leaf switch configuration:

  # View current configuration
  kubectl --namespace {{ .Release.Namespace }} get configmap ovn-bgp-agent-asn \
    -o jsonpath='{.data.mapping\.json}' | jq .

  # Edit configuration (changes apply to new pods)
  kubectl --namespace {{ .Release.Namespace }} edit configmap ovn-bgp-agent-asn

Configuration format:
  {
    "subnet_cidr": {
      "asn": "BGP AS Number",
      "ipv4_gateway": "IPv4 Gateway Address",
{{- if .Values.bgp.ipv6.enabled }}
      "ipv6_gateway": "IPv6 Gateway Address",
{{- end }}
      "description": "Optional description"
    }
  }

Note: ConfigMap persists across helm upgrades and can be safely edited at runtime.
Changes apply to pods as they restart.


TROUBLESHOOTING
---------------
If BGP sessions are not establishing:

1. Check init container logs:
   kubectl --namespace {{ .Release.Namespace }} logs daemonset/ovn-bgp-agent -c init-frr-config

2. Verify Leaf switch connectivity:
   kubectl --namespace {{ .Release.Namespace }} exec daemonset/ovn-bgp-agent -c ovn-bgp-agent -- \
     ping -c 3 <leaf-ipv4-address>
{{- if .Values.bgp.ipv6.enabled }}
   kubectl --namespace {{ .Release.Namespace }} exec daemonset/ovn-bgp-agent -c ovn-bgp-agent -- \
     ping6 -c 3 <leaf-ipv6-address>
{{- end }}

3. Verify Leaf configuration exists:
   kubectl --namespace {{ .Release.Namespace }} get configmap ovn-bgp-agent-asn -o yaml

4. Check FRR logs:
   kubectl --namespace {{ .Release.Namespace }} logs daemonset/ovn-bgp-agent -c frr


DOCUMENTATION
-------------
For more information:
  - OVN BGP Agent: https://docs.openstack.org/ovn-bgp-agent/latest/
  - Chart README: https://github.com/openstack/openstack-helm/tree/master/ovn-bgp-agent

================================================================================
{{- end }}